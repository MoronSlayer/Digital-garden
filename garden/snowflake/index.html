<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;600;700;800&family=Frank+Ruhl+Libre:wght@200;300;400;500;600&family=Encode+Sans+Semi+Condensed:wght@400&display=swap" rel=stylesheet><link rel=stylesheet type=text/css href=/Digital-garden/css/bootstrap.min.css><link rel=stylesheet type=text/css href=/Digital-garden/css/all.min.css><link disabled id=dark-mode-theme rel=stylesheet href=/Digital-garden/css/dark.css><link rel=stylesheet type=text/css href=/Digital-garden/css/style.css><link rel=stylesheet type=text/css href=/Digital-garden/css/my_style.css><title>My Digital Garden | Snowflake</title><meta name=description content></head><body><nav class="navbar navbar-expand-lg navbar-light bg-light"><div class=container><a class=navbar-brand href=https://ritesh1137.github.io/Digital-garden/><b style=font-weight:800>RP</b></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNavDropdown aria-controls=navbarNavDropdown aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavDropdown><ul class="navbar-nav ms-auto mt-2 mt-lg-0"><li class=nav-item><a class=nav-link href=/Digital-garden/garden/>Digital Garden</a></li><li class=nav-item><a class=nav-link href=/Digital-garden/projects/>Projects</a></li><li class=nav-item><a class=nav-link href=/Digital-garden/library/>Library</a></li><li class=nav-item><a class=nav-link href=/Digital-garden/about/>About</a></li><li class="nav-item px-2 pt-1"><a class="btn fas fa-moon" id=dark-mode-toggle></a></li></ul></div></div></nav><div id=content><div class=container style=max-width:800px><div class="py-4 rounded-3"><div class="container-fluid py-2"><h1 class="display-2 mb-4 text-center">Snowflake</h1></div><div class="text-center pt-4"></div></div><div class="row justify-content-center mb-5"><div class=col-12><p class="card-date m-0">Created Dec 17, 2023 -
Last updated: Dec 17, 2023</p><hr class=dropdown-divider><div class="row justify-content-between"><div class=col-sm-4><span class=status>Seeding ðŸŒ±</span></div><div class=col-sm-8 style=text-align:right><span onclick='handleTagClick("data_warehouse","garden")' class="badge tag-badge">data_warehouse</span>
<span onclick='handleTagClick("cloud","garden")' class="badge tag-badge">cloud</span></div></div></div></div><div class="container-fluid py-2"><div class="serif main-content"><h1 id=snowflake-cloud-based-data-warehousing>Snowflake: Cloud-Based Data Warehousing</h1><p>Snowflake is a cloud-based data warehousing platform known for its unique architecture and capabilities. It offers various features that are beneficial for data analytics and storage.</p><h2 id=key-aspects-of-snowflake>Key Aspects of Snowflake</h2><h3 id=1-cloud-based-data-warehouse>1. Cloud-Based Data Warehouse</h3><p>Snowflake is entirely cloud-based, providing scalability, flexibility, and ease of management without the need for physical infrastructure.</p><h3 id=2-unique-architecture>2. Unique Architecture</h3><p>It separates compute and storage resources, allowing for independent scaling and cost-effective use of resources.</p><h3 id=3-support-for-diverse-data>3. Support for Diverse Data</h3><p>Snowflake can manage both structured and semi-structured data, like JSON, Avro, or XML.</p><h3 id=4-performance-and-speed>4. Performance and Speed</h3><p>Due to its architecture, Snowflake can perform high-speed data processing and analytics efficiently.</p><h3 id=5-compatibility-and-integration>5. Compatibility and Integration</h3><p>It integrates with a wide range of data integration, ETL (Extract, Transform, Load), and BI (Business Intelligence) tools.</p><h3 id=6-security-and-compliance>6. Security and Compliance</h3><p>Snowflake provides robust security features and complies with various regulatory standards.</p><h3 id=7-data-sharing-capabilities>7. Data Sharing Capabilities</h3><p>Enables secure data sharing between Snowflake users, useful for collaborative data-driven projects.</p><h3 id=8-pay-as-you-go-pricing>8. Pay-As-You-Go Pricing</h3><p>Its pricing model is typically usage-based, offering a cost-effective solution compared to traditional data warehousing.</p><blockquote><p>Snowflake&rsquo;s combination of performance, scalability, and ease of use makes it a popular choice for leveraging cloud-based data warehousing in data analytics.</p></blockquote><hr><h1 id=notes-from-collaboration-marketplace--cost-estimation-workshop>Notes from Collaboration, Marketplace & Cost Estimation Workshop:</h1><p>Imagine your company has decided to use Snowflake, migrating from an older on-premise database system into the cloud. These are some notes on the management and administration of the extract process which can be redesigned so that customers can receive data via Snowflake sharing instead.</p><h3 id=understanding-inbound-shares>Understanding Inbound Shares:</h3><ul><li>You can view the shared databases by going to the main account&rsquo;s page in Snowflake and then Data -> Databases or Private Sharing</li><li>By default you have two databases, SNOWFLAKE_SAMPLE_DATA and SNOWFLAKE</li><li>Under Private sharing section we can see that the database called SNOWFLAKE_SAMPLE_DATA is coming from an account called SFSALESSHARED (followed by a schema that will vary by region). This account named their outbound share &ldquo;SAMPLE_DATA. An account named SNOWFLAKE is the source of our database called SNOWFLAKE but their original data source is named ACCOUNT_USAGE</li><li>SNOWFLAKE is a share given to every account and behind the scenes it&rsquo;s based on a direct share called ACCOUNT_USAGE, it includes schemas that are intended to help customers manage and understand their billing and usage.</li><li>If you drop a default database like the SNOWFLAKE_SAMPLE_DATA, you can see from the Private Sharing page that it is downloadable now, and the title of the database is not displayed, i.e, instead of seeing both SNOWFLAKE_SAMPLE_DATA at the bottom of the tile and the original data source at the top, we only see SAMPLE_DATA which is the name of the original data source at the top of the tile.</li></ul><p>Using the below SQL command, we can change the database names</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>alter</span> <span style=color:#00a8c8>database</span> <span style=color:#111>DEMO</span> 
</span></span><span style=display:flex><span><span style=color:#00a8c8>rename</span> <span style=color:#00a8c8>to</span> <span style=color:#111>snowflake_sample_data</span><span style=color:#111>;</span>
</span></span></code></pre></div><ul><li><p>You cannot drop the SNOWFLAKE database(original data source name: ACCOUNT_USAGE, remember!)</p></li><li><p>If a user e.g., SysAdmin does not have access to a specific database (SNOWFLAKE_SAMPLE_DATA), you can grant privilege from the database UI or use the SQL command below:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>grant</span> <span style=color:#111>imported</span> <span style=color:#00a8c8>privileges</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>on</span> <span style=color:#00a8c8>database</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>to</span> <span style=color:#00a8c8>role</span> <span style=color:#111>SYSADMIN</span><span style=color:#111>;</span>
</span></span></code></pre></div><hr><p>Using <strong>SELECT</strong> statements:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#75715e>--Check the range of values in the Market Segment Column
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>SELECT</span> <span style=color:#00a8c8>DISTINCT</span> <span style=color:#111>c_mktsegment</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>FROM</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>CUSTOMER</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>--Find out which Market Segments have the most customers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>SELECT</span> <span style=color:#111>c_mktsegment</span><span style=color:#111>,</span> <span style=color:#00a8c8>COUNT</span><span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>FROM</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>CUSTOMER</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>GROUP</span> <span style=color:#00a8c8>BY</span> <span style=color:#111>c_mktsegment</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>ORDER</span> <span style=color:#00a8c8>BY</span> <span style=color:#00a8c8>COUNT</span><span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#111>);</span>
</span></span></code></pre></div><figure><img src=./SELECT_sampleData.jpg width=100%><figcaption><h4>Select statement for sample and data and view of Worksheet in Snowflake</h4></figcaption></figure><hr><p>Joining and Aggregating data:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#75715e>-- Nations Table
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>SELECT</span> <span style=color:#111>N_NATIONKEY</span><span style=color:#111>,</span> <span style=color:#111>N_NAME</span><span style=color:#111>,</span> <span style=color:#111>N_REGIONKEY</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>FROM</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>NATION</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Regions Table
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>SELECT</span> <span style=color:#111>R_REGIONKEY</span><span style=color:#111>,</span> <span style=color:#111>R_NAME</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>FROM</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>REGION</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Join the Tables and Sort
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>SELECT</span> <span style=color:#111>R_NAME</span> <span style=color:#00a8c8>as</span> <span style=color:#111>Region</span><span style=color:#111>,</span> <span style=color:#111>N_NAME</span> <span style=color:#00a8c8>as</span> <span style=color:#111>Nation</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>FROM</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>NATION</span> 
</span></span><span style=display:flex><span><span style=color:#00a8c8>JOIN</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>REGION</span> 
</span></span><span style=display:flex><span><span style=color:#00a8c8>ON</span> <span style=color:#111>N_REGIONKEY</span> <span style=color:#f92672>=</span> <span style=color:#111>R_REGIONKEY</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>ORDER</span> <span style=color:#00a8c8>BY</span> <span style=color:#111>R_NAME</span><span style=color:#111>,</span> <span style=color:#111>N_NAME</span> <span style=color:#00a8c8>ASC</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>--Group and Count Rows Per Region
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>SELECT</span> <span style=color:#111>R_NAME</span> <span style=color:#00a8c8>as</span> <span style=color:#111>Region</span><span style=color:#111>,</span> <span style=color:#00a8c8>count</span><span style=color:#111>(</span><span style=color:#111>N_NAME</span><span style=color:#111>)</span> <span style=color:#00a8c8>as</span> <span style=color:#111>NUM_COUNTRIES</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>FROM</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>NATION</span> 
</span></span><span style=display:flex><span><span style=color:#00a8c8>JOIN</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>REGION</span> 
</span></span><span style=display:flex><span><span style=color:#00a8c8>ON</span> <span style=color:#111>N_REGIONKEY</span> <span style=color:#f92672>=</span> <span style=color:#111>R_REGIONKEY</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>GROUP</span> <span style=color:#00a8c8>BY</span> <span style=color:#111>R_NAME</span><span style=color:#111>;</span>
</span></span></code></pre></div><figure><img src=./JOIN_aggData.jpg width=100%><figcaption><h4>Join and Aggregate Shared Data</h4></figcaption></figure><hr><p>Warehouses can be costly when not carefully managed, so their use is restricted to Administrative users. Because of this, Warehouse functions are under the Admin menu.</p><p>Any warehouse that has to be given access to another user, e.g., SYSADMIN should be given access to COMPUTE_WH can be done by granting priveleges.</p><figure><img src=./grantComputeWHPrivelege.png width=100%></figure><hr><h4 id=creating-a-local-database-with-a-different-user>Creating a local database with a different user</h4><figure><img src=./newLocalDB1.png width=100%></figure><figure><img src=./newLocalDB2.png width=100%></figure><hr><h3 id=usage-and-cost-management>Usage and Cost Management</h3><p>Cost of different accounts and regions can be found at <a href=https://www.snowflake.com/en/data-cloud/pricing-options/>https://www.snowflake.com/en/data-cloud/pricing-options/</a></p><p>From the Admin account, we can see the cost of running any warehouse as shown in the image below</p><figure><img src=./usageCost.png width=100%></figure><p>In this image we have used 53% of 1 credit for the COMPUTE_WH warehouse</p><hr><h3 id=creating-a-local-database-and-warehouse>Creating a Local Database and Warehouse</h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#111>use</span> <span style=color:#00a8c8>role</span> <span style=color:#111>SYSADMIN</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>create</span> <span style=color:#00a8c8>database</span> <span style=color:#111>INTL_DB</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>use</span> <span style=color:#00a8c8>schema</span> <span style=color:#111>INTL_DB</span><span style=color:#111>.</span><span style=color:#00a8c8>PUBLIC</span><span style=color:#111>;</span>
</span></span></code></pre></div><p>Here we created a new database valled INTL_DB, now let&rsquo;s create a Warehouse for this database</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#111>use</span> <span style=color:#00a8c8>role</span> <span style=color:#111>SYSADMIN</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>create</span> <span style=color:#111>warehouse</span> <span style=color:#111>INTL_WH</span> 
</span></span><span style=display:flex><span><span style=color:#00a8c8>with</span> 
</span></span><span style=display:flex><span><span style=color:#111>warehouse_size</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;XSMALL&#39;</span> 
</span></span><span style=display:flex><span><span style=color:#111>warehouse_type</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;STANDARD&#39;</span> 
</span></span><span style=display:flex><span><span style=color:#111>auto_suspend</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>600</span> <span style=color:#75715e>--600 seconds/10 mins
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#111>auto_resume</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>TRUE</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>use</span> <span style=color:#111>warehouse</span> <span style=color:#111>INTL_WH</span><span style=color:#111>;</span>
</span></span></code></pre></div><p>Now, creating a New Table in our database INTL_DB</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>create</span> <span style=color:#00a8c8>or</span> <span style=color:#00a8c8>replace</span> <span style=color:#00a8c8>table</span> <span style=color:#111>intl_db</span><span style=color:#111>.</span><span style=color:#00a8c8>public</span><span style=color:#111>.</span><span style=color:#111>INT_STDS_ORG_3166</span> 
</span></span><span style=display:flex><span><span style=color:#111>(</span><span style=color:#111>iso_country_name</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>100</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span> <span style=color:#111>country_name_official</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>200</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span> <span style=color:#111>sovreignty</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>40</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span> <span style=color:#111>alpha_code_2digit</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>2</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span> <span style=color:#111>alpha_code_3digit</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>3</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span> <span style=color:#111>numeric_country_code</span> <span style=color:#111>integer</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span> <span style=color:#111>iso_subdivision</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>15</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span> <span style=color:#111>internet_domain_code</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>10</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>);</span>
</span></span></code></pre></div><p>This will be created in the public schema.</p><p>Creating a file format to load the table:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>create</span> <span style=color:#00a8c8>or</span> <span style=color:#00a8c8>replace</span> <span style=color:#111>file</span> <span style=color:#111>format</span> <span style=color:#111>util_db</span><span style=color:#111>.</span><span style=color:#00a8c8>public</span><span style=color:#111>.</span><span style=color:#111>PIPE_DBLQUOTE_HEADER_CR</span> 
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>type</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;CSV&#39;</span> <span style=color:#75715e>--use CSV for any flat file
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#111>compression</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;AUTO&#39;</span> 
</span></span><span style=display:flex><span>  <span style=color:#111>field_delimiter</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;|&#39;</span> <span style=color:#75715e>--pipe or vertical bar
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#111>record_delimiter</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;\r&#39;</span> <span style=color:#75715e>--carriage return
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#111>skip_header</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>  <span style=color:#75715e>--1 header row
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#111>field_optionally_enclosed_by</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;\042&#39;</span>  <span style=color:#75715e>--double quotes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#111>trim_space</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>FALSE</span><span style=color:#111>;</span>
</span></span></code></pre></div><p>Here:</p><ul><li>We created a file format.</li><li>file format will be used to process a flat text file.</li><li>file format will skip the first row (header).</li><li>file format will know how to separate values because of a pipe separator.</li></ul><hr><h3 id=loading-iso-table-using-file-format-from-a-new-stage>Loading ISO Table Using File Format from a new stage</h3><h5 id=creating-stage-from-ui>Creating Stage from UI</h5><figure><img src=./createStage_step1.png width=100%></figure><figure><img src=./createStage_step2.png width=100%></figure><p>Now granting privileges to SysAdmin:</p><figure><img src=./createStage_step3.png width=100%></figure><p>Alternatively, using SQL:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>create</span> <span style=color:#111>stage</span> <span style=color:#111>util_db</span><span style=color:#111>.</span><span style=color:#00a8c8>public</span><span style=color:#111>.</span><span style=color:#111>aws_s3_bucket</span> <span style=color:#111>url</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;s3://uni-cmcw&#39;</span><span style=color:#111>;</span>
</span></span></code></pre></div><p>We need to load a file called <strong>iso_countries_utf8_pipe.csv</strong> and AWS is case sensitive, so to check:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#111>list</span> <span style=color:#f92672>@</span><span style=color:#111>util_db</span><span style=color:#111>.</span><span style=color:#00a8c8>public</span><span style=color:#111>.</span><span style=color:#111>aws_s3_bucket</span><span style=color:#111>;</span>
</span></span></code></pre></div><h4 id=loading-data-into-the-table-from-stage>Loading data into the table from stage</h4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>copy</span> <span style=color:#00a8c8>into</span> <span style=color:#111>INT_STDS_ORG_3166</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>from</span> <span style=color:#f92672>@</span><span style=color:#111>UTIL_DB</span><span style=color:#111>.</span><span style=color:#00a8c8>PUBLIC</span><span style=color:#111>.</span><span style=color:#111>AWS_S3_BUCKET</span>
</span></span><span style=display:flex><span><span style=color:#111>files</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span> <span style=color:#d88200>&#39;ISO_Countries_UTF8_pipe.csv&#39;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>file_format</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span> <span style=color:#111>format_name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;UTIL_DB.PUBLIC.PIPE_DBLQUOTE_HEADER_CR&#39;</span> <span style=color:#111>);</span>
</span></span></code></pre></div><figure><img src=./createStage_step4.png width=100%></figure><p>(<em>dropped ISO table as stage name and used SQL to recreate the stage</em>)</p><hr><h4 id=testing-that-we-loaded-the-expected-number-of-rows>Testing that we loaded the expected number of rows</h4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>select</span> <span style=color:#00a8c8>row_count</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>from</span> <span style=color:#111>INTL_DB</span><span style=color:#111>.</span><span style=color:#111>INFORMATION_SCHEMA</span><span style=color:#111>.</span><span style=color:#111>TABLES</span> 
</span></span><span style=display:flex><span><span style=color:#00a8c8>where</span> <span style=color:#111>table_schema</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;PUBLIC&#39;</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>and</span> <span style=color:#00a8c8>table_name</span><span style=color:#f92672>=</span> <span style=color:#d88200>&#39;INT_STDS_ORG_3166&#39;</span><span style=color:#111>;</span>
</span></span></code></pre></div><h4 id=joining-local-and-shared-data>Joining local and shared data</h4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>select</span>  
</span></span><span style=display:flex><span>     <span style=color:#111>iso_country_name</span>
</span></span><span style=display:flex><span>    <span style=color:#111>,</span><span style=color:#111>country_name_official</span><span style=color:#111>,</span><span style=color:#111>alpha_code_2digit</span>
</span></span><span style=display:flex><span>    <span style=color:#111>,</span><span style=color:#111>r_name</span> <span style=color:#00a8c8>as</span> <span style=color:#111>region</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>from</span> <span style=color:#111>INTL_DB</span><span style=color:#111>.</span><span style=color:#00a8c8>PUBLIC</span><span style=color:#111>.</span><span style=color:#111>INT_STDS_ORG_3166</span> <span style=color:#111>i</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>left</span> <span style=color:#00a8c8>join</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>NATION</span> <span style=color:#111>n</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>on</span> <span style=color:#00a8c8>upper</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>.</span><span style=color:#111>iso_country_name</span><span style=color:#111>)</span><span style=color:#f92672>=</span> <span style=color:#111>n</span><span style=color:#111>.</span><span style=color:#111>n_name</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>left</span> <span style=color:#00a8c8>join</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>REGION</span> <span style=color:#111>r</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>on</span> <span style=color:#111>n_regionkey</span> <span style=color:#f92672>=</span> <span style=color:#111>r_regionkey</span><span style=color:#111>;</span>
</span></span></code></pre></div><h5 id=converting-select-statment-into-view>Converting Select statment into View</h5><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>create</span> <span style=color:#00a8c8>view</span> <span style=color:#111>intl_db</span><span style=color:#111>.</span><span style=color:#00a8c8>public</span><span style=color:#111>.</span><span style=color:#111>NATIONS_SAMPLE_PLUS_ISO</span> 
</span></span><span style=display:flex><span><span style=color:#111>(</span> <span style=color:#111>iso_country_name</span>
</span></span><span style=display:flex><span>  <span style=color:#111>,</span><span style=color:#111>country_name_official</span>
</span></span><span style=display:flex><span>  <span style=color:#111>,</span><span style=color:#111>alpha_code_2digit</span>
</span></span><span style=display:flex><span>  <span style=color:#111>,</span><span style=color:#111>region</span><span style=color:#111>)</span> <span style=color:#00a8c8>AS</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>select</span>  
</span></span><span style=display:flex><span>    <span style=color:#111>iso_country_name</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#111>country_name_official</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#111>alpha_code_2digit</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#111>r_name</span> <span style=color:#00a8c8>as</span> <span style=color:#111>region</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>from</span> <span style=color:#111>INTL_DB</span><span style=color:#111>.</span><span style=color:#00a8c8>PUBLIC</span><span style=color:#111>.</span><span style=color:#111>INT_STDS_ORG_3166</span> <span style=color:#111>i</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>left</span> <span style=color:#00a8c8>join</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>NATION</span> <span style=color:#111>n</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>on</span> <span style=color:#00a8c8>upper</span><span style=color:#111>(</span><span style=color:#111>i</span><span style=color:#111>.</span><span style=color:#111>iso_country_name</span><span style=color:#111>)</span><span style=color:#f92672>=</span> <span style=color:#111>n</span><span style=color:#111>.</span><span style=color:#111>n_name</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>left</span> <span style=color:#00a8c8>join</span> <span style=color:#111>SNOWFLAKE_SAMPLE_DATA</span><span style=color:#111>.</span><span style=color:#111>TPCH_SF1</span><span style=color:#111>.</span><span style=color:#111>REGION</span> <span style=color:#111>r</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>on</span> <span style=color:#111>n_regionkey</span> <span style=color:#f92672>=</span> <span style=color:#111>r_regionkey</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#111>;</span>
</span></span></code></pre></div><ul><li><p>Creating a view makes a select statement behave like a table.</p></li><li><p>If we find yourself using the logic of a select statement over and over again, it can be more convenient to wrap the statement in a view, and run simple queries on the view.</p></li><li><p>Views can make our code more modular and organized.</p></li></ul><h6 id=running-a-select-statement-on-the-view>Running a select statement on the view</h6><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>select</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>from</span> <span style=color:#111>intl_db</span><span style=color:#111>.</span><span style=color:#00a8c8>public</span><span style=color:#111>.</span><span style=color:#111>NATIONS_SAMPLE_PLUS_ISO</span><span style=color:#111>;</span>
</span></span></code></pre></div><h4 id=more-data-into-intl_db-the-database-we-created>More data into INTL_DB, the database we created</h4><p>Creating table currencies</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>create</span> <span style=color:#00a8c8>table</span> <span style=color:#111>intl_db</span><span style=color:#111>.</span><span style=color:#00a8c8>public</span><span style=color:#111>.</span><span style=color:#111>CURRENCIES</span> 
</span></span><span style=display:flex><span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>  <span style=color:#111>currency_ID</span> <span style=color:#111>integer</span><span style=color:#111>,</span> 
</span></span><span style=display:flex><span>  <span style=color:#111>currency_char_code</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>3</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span>  <span style=color:#111>currency_symbol</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>4</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span>  <span style=color:#111>currency_digital_code</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>3</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span>  <span style=color:#111>currency_digital_name</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>30</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>comment</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;Information about currencies including character codes, symbols, digital codes, etc.&#39;</span><span style=color:#111>;</span>
</span></span></code></pre></div><p>Creating Table Country to Currency</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>create</span> <span style=color:#00a8c8>table</span> <span style=color:#111>intl_db</span><span style=color:#111>.</span><span style=color:#00a8c8>public</span><span style=color:#111>.</span><span style=color:#111>COUNTRY_CODE_TO_CURRENCY_CODE</span> 
</span></span><span style=display:flex><span>  <span style=color:#111>(</span>
</span></span><span style=display:flex><span>    <span style=color:#111>country_char_code</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>3</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span>    <span style=color:#111>country_numeric_code</span> <span style=color:#111>integer</span><span style=color:#111>,</span> 
</span></span><span style=display:flex><span>    <span style=color:#111>country_name</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>100</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span>    <span style=color:#111>currency_name</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>100</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span>    <span style=color:#111>currency_char_code</span> <span style=color:#111>varchar</span><span style=color:#111>(</span><span style=color:#ae81ff>3</span><span style=color:#111>),</span> 
</span></span><span style=display:flex><span>    <span style=color:#111>currency_numeric_code</span> <span style=color:#111>integer</span>
</span></span><span style=display:flex><span>  <span style=color:#111>)</span> 
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>comment</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;Mapping table currencies to countries&#39;</span><span style=color:#111>;</span>
</span></span></code></pre></div><p>Creating a File Format to Process files with Commas, Linefeeds and a Header Row</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>create</span> <span style=color:#111>file</span> <span style=color:#111>format</span> <span style=color:#111>util_db</span><span style=color:#111>.</span><span style=color:#00a8c8>public</span><span style=color:#111>.</span><span style=color:#111>CSV_COMMA_LF_HEADER</span>
</span></span><span style=display:flex><span>  <span style=color:#00a8c8>type</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;CSV&#39;</span> 
</span></span><span style=display:flex><span>  <span style=color:#111>field_delimiter</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;,&#39;</span> 
</span></span><span style=display:flex><span>  <span style=color:#111>record_delimiter</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;\n&#39;</span> <span style=color:#75715e>-- the n represents a Line Feed character
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#111>skip_header</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> 
</span></span><span style=display:flex><span><span style=color:#111>;</span>
</span></span></code></pre></div><p>Now, to load data from the S3 bucket in file stage</p><figure><img src=./list_s3Files.png width=100%></figure><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>copy</span> <span style=color:#00a8c8>into</span> <span style=color:#111>CURRENCIES</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>from</span> <span style=color:#f92672>@</span><span style=color:#111>UTIL_DB</span><span style=color:#111>.</span><span style=color:#00a8c8>PUBLIC</span><span style=color:#111>.</span><span style=color:#111>AWS_S3_BUCKET</span>
</span></span><span style=display:flex><span><span style=color:#111>files</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span> <span style=color:#d88200>&#39;currencies.csv&#39;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>file_format</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span> <span style=color:#111>format_name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;UTIL_DB.PUBLIC.CSV_COMMA_LF_HEADER&#39;</span> <span style=color:#111>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#00a8c8>copy</span> <span style=color:#00a8c8>into</span> <span style=color:#111>COUNTRY_CODE_TO_CURRENCY_CODE</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>from</span> <span style=color:#f92672>@</span><span style=color:#111>UTIL_DB</span><span style=color:#111>.</span><span style=color:#00a8c8>PUBLIC</span><span style=color:#111>.</span><span style=color:#111>AWS_S3_BUCKET</span>
</span></span><span style=display:flex><span><span style=color:#111>files</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span> <span style=color:#d88200>&#39;country_code_to_currency_code.csv&#39;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>file_format</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span> <span style=color:#111>format_name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;UTIL_DB.PUBLIC.CSV_COMMA_LF_HEADER&#39;</span> <span style=color:#111>);</span>
</span></span></code></pre></div><figure><img src=./newData.png width=100%></figure><h2 id=creating-a-new-account-for-acme-organization-with-orgadmin-role>Creating a new account for ACME organization with ORGADMIN role</h2><figure><img src=./orgAdmin.png width=100%></figure><h4 id=listings>Listings</h4><p>To share data between different accounts, privately, listing can be used</p><p><figure><img src=./listing_1.png width=100%></figure><figure><img src=./listing_2.png width=100%></figure></p><h3 id=pricing-of-snowflake>Pricing of Snowflake</h3><p>Depends on 4 factors:</p><ul><li>Average compressed storage used per month</li><li>compute credits based on amount of time warehouse is in use</li><li>cloud services like state management</li><li>serverless features like Snowpipe, replication, and clustering.</li></ul></div></div></div></div><div class=container><div class="row justify-content-between"><div class=col-sm-4><p class=footer>Ritesh Panditi Â© 2024</p></div><div class="col-sm-6 d-flex flex-row-reverse"><a class="footer-social px-2" href=# target=_blank><i class="fab fa-twitter"></i></a>
<a class="footer-social px-2" href=# target=_blank><i class="fab fa-github"></i></a>
<a class="footer-social px-2" href=# target=_blank><i class="fab fa-medium-m"></i></a>
<a class="footer-social px-2" href=# target=_blank><i class="fab fa-linkedin-in"></i></a></div></div></div><script src=/Digital-garden/js/bootstrap.min.js></script>
<script type=text/javascript src=/Digital-garden/js/jquery.min.js></script>
<script src=/Digital-garden/js/isotope.pkgd.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity=sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D crossorigin=anonymous async></script>
<script src=/Digital-garden/js/dark.js></script>
<script>var savedTheme=localStorage.getItem("dark-mode-storage")||"light";setTheme(savedTheme)</script><script src=/Digital-garden/js/isotope.js></script>
<script src=/Digital-garden/js/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script><script src=/Digital-garden/js/tag_handler.js></script></body></html>